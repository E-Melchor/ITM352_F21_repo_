<!--Emily Melchor
Home Page
Modified from Multi_Page_Nav example; top menu modified from Food Blog Template (https://www.w3schools.com/w3css/w3css_templates.asp)-->
<title>The Jasmine Dragon</title>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karma">
    <link rel="stylesheet" href="./CSS/display.css">
    <script src="./functions.js"></script>
    <script>
        // get the query string
        let params = (new URL(document.location)).searchParams;
        if (params.has('products_key')) {
            var this_product_key = params.get('products_key');
        } else {
            document.write('no products key in query string');
            document.stop;
        }
        var products_data;
        loadJSON('get_products_data', function(response) {
            // Parsing JSON string into object
            products_data = JSON.parse(response);
        });
    </script>
</head>

<body>
    <!-- Top menu -->
    <div class="w3-top">
        <div class="w3-white w3-xlarge" style="max-width:1200px;margin:auto">
            <div class="w3-button w3-padding-16 w3-left">
                <a href="./index.html"><img src="./images/dragon_logo.png" style="height: 45px;"></a>
            </div>
            <div class="w3-right w3-padding-16" style="margin-right:15px;"><a href="./login_page.html" style="text-decoration: none;">Login</a></div>
            <div class="w3-center w3-padding-16">The Jasmine Dragon</div>
        </div>
    </div>
    <div class="w3-main w3-content w3-padding" style="max-width:1200px;margin-top:75px">
        <!-- Navigation bar -->
        <center>
            <a href='index.html' style='color: darkgreen;'>Home<a>&nbsp&nbsp&nbsp;
            <script>
                for (products_key in products_data) {
                    if (products_key == this_product_key) continue;
                    document.write(`<a style='color: darkgreen;' href='./display_products.html?products_key=${products_key}'>${products_key}<a>&nbsp&nbsp&nbsp;`);
                }
            </script>
</center>

<!-- Products Pages -->
<script>
    // This function takes a string assumed to be a key in the products array above to display and select the corresponding products
    var order_str = '';
    // get the particular products to display
    var products = products_data[this_product_key];
    if (params.has('Submit')) {
        // grab the quantities from the query string
        order_str = 'Your order is:<br>';
        for (i = 0; i < products.length; i++) {
            order_str += `You want ${params.get(`quantities${i}`)} of ${products[i]['name']}<br>`;
        }
    } else {
        order_str += `<center><h2>${this_product_key}</h2></center><br>`;
        // We put the whole table in the form so that anything entered in it will get submitted
        order_str += `<center>
            <FORM action="" method="GET">
            <INPUT TYPE="HIDDEN" NAME="products_key" VALUE="${products_key}">`;

        for (i = 0; i < products.length; i++) {
            order_str += `<div class="w3-quarter"><img src="./images/${products[i]['image']}" style="height:200px;width:auto"><br>
            ${products[i]['type']}<br>
            $${products[i]['price'].toFixed(2)} | Quantity in Stock: ${products[i]['quantity']}<br>
            <INPUT TYPE="TEXT" name="quantities${i}" placeholder="Enter Quantity"><br></div>`;
        }
        order_str += `<div><INPUT TYPE="SUBMIT"  name="Submit" value="Add to Cart"></div></FORM>`;
    } // this closes the else for the form and table display
    document.write(order_str);
</script>
</body>